local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local workspace = game:GetService("Workspace")

-- 发送聊天消息函数
local function SendChatMessage(message)
    if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local textChannel = TextChatService.TextChannels.RBXGeneral
        if textChannel then
            textChannel:SendAsync(message)
        end
    else
        local chatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
        local sayEvent = chatEvents and chatEvents:FindFirstChild("SayMessageRequest")
        if sayEvent then
            sayEvent:FireServer(message, "All")
        end
    end
end

SendChatMessage("进QQ群.")
SendChatMessage("[下面数字连起来]")
SendChatMessage("[群号10733]")
SendChatMessage("[56482]")

-- 等待角色加载完成（优化版，避免空引用）
local function waitForCharacter()
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid", 30)
    assert(humanoid, "[WX HUB] 角色加载超时，无法获取Humanoid")
    return humanoid, character
end

-- 创建加载通知UI
local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local customNotificationGui = Instance.new("ScreenGui")
customNotificationGui.Name = "CustomNotificationGui"
customNotificationGui.Parent = playerGui

local notificationFrame = Instance.new("Frame")
notificationFrame.Size = UDim2.new(0, 300, 0, 100)
notificationFrame.Position = UDim2.new(1, 0, 1, -110)
notificationFrame.BackgroundColor3 = Color3.new(0, 0, 0)
notificationFrame.BackgroundTransparency = 0.2
notificationFrame.BorderSizePixel = 0
notificationFrame.Parent = customNotificationGui

local loadingRing = Instance.new("ImageLabel")
loadingRing.Size = UDim2.new(1.2, 0, 1.2, 0)
loadingRing.Position = UDim2.new(-0.1, 0, -0.1, 0)
loadingRing.BackgroundTransparency = 1
loadingRing.Image = "rbxassetid://1011584077"
loadingRing.ImageColor3 = Color3.new(1, 1, 1)
loadingRing.Parent = notificationFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 30)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.new(1, 1, 1)
titleLabel.Text = "WX脚本"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 18
titleLabel.Parent = notificationFrame

local contentLabel = Instance.new("TextLabel")
contentLabel.Size = UDim2.new(1, -20, 0, 40)
contentLabel.Position = UDim2.new(0, 10, 0, 45)
contentLabel.BackgroundTransparency = 1
contentLabel.TextColor3 = Color3.new(1, 1, 1)
contentLabel.Text = "WX HUB加载中"
contentLabel.Font = Enum.Font.SourceSans
contentLabel.TextSize = 16
contentLabel.Parent = notificationFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 20, 0, 20)
closeButton.Position = UDim2.new(1, -30, 0, 10)
closeButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.new(1, 1, 1)
closeButton.Parent = notificationFrame

closeButton.MouseButton1Click:Connect(function()
    customNotificationGui:Destroy()
end)

-- 加载动画
local rotateTweenInfo = TweenInfo.new(2, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1)
local rotateTween = TweenService:Create(loadingRing, rotateTweenInfo, {Rotation = 360})
rotateTween:Play()

local targetPosition = UDim2.new(1, -310, 1, -110)
local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local tween = TweenService:Create(notificationFrame, tweenInfo, {Position = targetPosition})
tween:Play()

wait(5)
customNotificationGui:Destroy()

-- 加载ESP
local ESP = loadstring(game:HttpGet("https://raw.githubusercontent.com/bailib/Roblox/refs/heads/main/main/ESP.lua"))()
ESP.AddFolder("HiderESPFolder")
ESP.AddFolder("HunterESPFolder")
ESP.AddFolder("GlassESPFolder")

-- 加载WindUI
local WindUISuccess, WindUI = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
end)

if not WindUISuccess then
    error("❌ WindUI加载失败: "..tostring(WindUI))
    return
end

-- 渐变文字函数
function gradient(text, startColor, endColor)
    if not text or #text == 0 then return "" end
    if not startColor or not endColor then
        warn("⚠️ 颜色参数无效，使用默认颜色")
        startColor = Color3.fromRGB(255,255,255)
        endColor = Color3.fromRGB(200,200,200)
    end

    local result = ""
    local length = #text

    for i = 1, length do
        local t = (i - 1) / math.max(length - 1, 1)
        local r = math.floor((startColor.R + (endColor.R - startColor.R) * t) * 255)
        local g = math.floor((startColor.G + (endColor.G - startColor.G) * t) * 255)
        local b = math.floor((startColor.B + (endColor.B - startColor.B) * t) * 255)

        local char = text:sub(i, i)
        result = result .. string.format('<font color="rgb(%d,%d,%d)">%s</font>', r, g, b, char)
    end

    return result
end

-- 欢迎弹窗
local Confirmed = false
local popupSuccess, popupResult = pcall(function()
    WindUI:Popup({
        Title = "欢迎使用WX HUB",
        Icon = "rbxassetid://88797484203913",
        Content = "q群获取卡密"..gradient("WX HUB", Color3.fromHex("#00FF87"), Color3.fromHex("#60EFFF")).."欢迎使用",
        Buttons = {
            {
                Title = "取消",
                Callback = function() end,
                Variant = "Secondary"
            },
            {
                Title = "继续",
                Icon = "arrow-right",
                Callback = function() Confirmed = true end,
                Variant = "Primary"
            }
        }
    })
end)

if not popupSuccess then
    warn("⚠️ 弹窗创建失败: "..tostring(popupResult))
    Confirmed = true
end

repeat task.wait() until Confirmed

-- 创建主窗口
local Window
local windowSuccess, windowResult = pcall(function()
    return WindUI:CreateWindow({
        Title = "WX脚本",
        Icon = "rbxassetid://88797484203913",
        Author = "进Q群获取卡密1027562039",
        Folder = "ColdSilence",
        Size = UDim2.fromOffset(300, 350),
        Theme = "Dark",
        User = {
            Enabled = true,
            Callback = function() print("用户按钮点击") end,
            Anonymous = false
        },
        KeySystem = {
            Key = { "WX_1q64jf"},
            Note = "请输入有效卡密  \n\n获取卡密进群:1027562039",
            SaveKey = false
        }
    })
end)

if not windowSuccess then
    error("❌ 窗口创建失败: "..tostring(windowResult))
    return
else
    Window = windowResult
end

-- 创建顶部按钮
local function safeCreateButton(name, icon, callback, order)
    pcall(function()
        Window:CreateTopbarButton(name, icon, callback, order)
    end)
end

safeCreateButton("MyButton1", "bird", function() print("按钮1") end, 990)
safeCreateButton("MyButton2", "settings", function() Window:ToggleFullscreen() end, 989)

-- 内存优化
task.defer(function()
    collectgarbage("collect")
    print("✅ 内存优化完成 | 当前用量:", math.floor((collectgarbage("count")/1024)).."MB")
end)

-- 创建标签页
local Tabs = {}

-- 通用Section（添加功能标签页）
do
    Tabs.LOLTab = Window:Section({Title = "通用", Opened = true})
    -- 通用Section下添加"角色属性设置"标签页
    Tabs.tyTab = Tabs.LOLTab:Tab({ Title = "通用", Icon = "user" })
end

-- 服务器脚本Section
do
    Tabs.MainTab = Window:Section({Title = "服务器脚本", Opened = true})
    Tabs.CSJTab = Tabs.MainTab:Tab({ Title = "偷走脑红", Icon = "zap" })
    Tabs.MLTab = Tabs.MainTab:Tab({ Title = "植物VS大脑机器人", Icon = "zap" })
    Tabs.FWTab = Tabs.MainTab:Tab({ Title = "99夜", Icon = "zap" })
    Tabs.HDTab = Tabs.MainTab:Tab({ Title = "伐木大亨", Icon = "zap" })
    Tabs.KFTab = Tabs.MainTab:Tab({ Title = "自动汉化", Icon = "zap" })
    Tabs.ZRTab = Tabs.MainTab:Tab({ Title = "无敌少侠", Icon = "zap" })
    Tabs.HZTab = Tabs.MainTab:Tab({ Title = "战争大亨", Icon = "zap" })
    Tabs.SFTab = Tabs.MainTab:Tab({ Title = "饲养宠物", Icon = "zap" })
    Tabs.DZTab = Tabs.MainTab:Tab({ Title = "boors", Icon = "zap" })
    Tabs.TYGNTab = Tabs.MainTab:Tab({ Title = "极速传奇", Icon = "zap" })
    Tabs.WJTab = Tabs.MainTab:Tab({ Title = "WX分支", Icon = "zap" })
    Tabs.PVPTab = Tabs.MainTab:Tab({ Title = "兵工厂", Icon = "zap" })
    Tabs.CBTab = Tabs.MainTab:Tab({ Title = "种植花园", Icon = "zap" })
end

-- 修复后的数值输入框和按钮
local humanoid, character = waitForCharacter()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- 移动速度数值输入（删除聊天提示）
Tabs.tyTab:Input({
    Title = "移动速度",
    Placeholder = "输入16-200之间的数值",
    Default = "20",
    Callback = function(Value)
        local speed = tonumber(Value)
        if speed and speed >= 16 and speed <= 200 then
            local currentHumanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if currentHumanoid then
                currentHumanoid.WalkSpeed = speed
            end
        end
    end
})

-- 跳跃高度数值输入（范围改为5~200）
Tabs.tyTab:Input({
    Title = "跳跃高度",
    Placeholder = "输入5-200之间的数值",
    Default = "50", -- 调整为更合理的默认值
    Callback = function(Value)
        local jumpPower = tonumber(Value)
        if jumpPower and jumpPower >= 5 and jumpPower <= 200 then
            -- 每次都需要重新获取当前角色[3](@ref)
            local character = LocalPlayer.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid and humanoid.Health > 0 then
                    humanoid.JumpPower = jumpPower
                    print("跳跃高度已设置为: " .. jumpPower)
                else
                    warn("❌ 角色未就绪或已死亡")
                end
            else
                warn("❌ 角色不存在")
            end
        else
            warn("⚠️ 请输入5-200之间的有效数值")
        end
    end
})

-- 重力系数数值输入（删除聊天提示）
Tabs.tyTab:Input({
    Title = "重力系数",
    Placeholder = "输入0.1-5之间的数值",
    Default = "1",
    Callback = function(Value)
        local gravityCoeff = tonumber(Value)
        if gravityCoeff and gravityCoeff >= 0.1 and gravityCoeff <= 5 then
            workspace.Gravity = 196.2 * gravityCoeff
        end
    end
})

-- 第三行：显示北京时间（新增功能）
Tabs.tyTab:Button({
    Title = "显示北京时间",
    Desc = "实时显示当前北京时间",
    Callback = function()
        -- 清理已存在的时间UI，避免重复创建
        if game.CoreGui:FindFirstChild("LBLG") then
            game.CoreGui.LBLG:Destroy()
        end

        local LBLG = Instance.new("ScreenGui")
        local LBL = Instance.new("TextLabel")

        -- 配置UI父级和基础属性
        LBLG.Name = "LBLG"
        LBLG.Parent = game.CoreGui
        LBLG.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        LBLG.Enabled = true

        LBL.Name = "LBL"
        LBL.Parent = LBLG
        LBL.BackgroundColor3 = Color3.new(0, 0, 0) -- 黑色背景（原代码颜色无效，修正为有效RGB）
        LBL.BackgroundTransparency = 0.5 -- 半透明，不遮挡视线
        LBL.BorderColor3 = Color3.new(1, 1, 1) -- 白色边框
        LBL.BorderSizePixel = 1 -- 显示边框
        LBL.Position = UDim2.new(0.75, 0, 0.01, 0)
        LBL.Size = UDim2.new(0, 133, 0, 30)
        LBL.Font = Enum.Font.GothamSemibold
        LBL.TextColor3 = Color3.new(1, 1, 1) -- 白色文字（原代码颜色无效，修正）
        LBL.TextScaled = true
        LBL.TextSize = 14
        LBL.TextWrapped = true
        LBL.Visible = true

        -- 实时更新时间（修复原代码时间格式错误）
        game:GetService("RunService").Heartbeat:Connect(function()
            local hour = os.date("%H")
            local min = os.date("%M")
            local sec = os.date("%S")
            LBL.Text = string.format("当前时间: %s:%s:%s", hour, min, sec)
        end)
    end
})

Tabs.tyTab:Button({
    Title = "重置人物",
    Callback = function()
        if humanoid and humanoid.Health > 0 then
            humanoid.Health = 0
            -- 不需要等待0.5秒，因为waitForCharacter会等待角色加载
            humanoid, character = waitForCharacter()
            if humanoid then
                humanoid.WalkSpeed = 20
                if humanoid.RigType == Enum.HumanoidRigType.R15 then
                    humanoid.JumpPower = 50
                else
                    humanoid.JumpPower = 7.2
                end
                workspace.Gravity = 196.2
            end
        end
    end
})

-- 服务器脚本各类按钮（保持原有功能不变）
Tabs.CSJTab:Button({
    Title = "偷走脑红",
    Desc = "加载慢",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/UrFSwAvs/raw"))()
    end
})

Tabs.CSJTab:Button({
    Title = "偷走脑红钓鱼",
    Desc = "好用",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/somepath/somefile.lua"))()
    end
})

Tabs.CSJTab:Button({
    Title = "偷走脑红",
    Desc = "汉化",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/ULdWe37N/raw"))()
    end
})

Tabs.MLTab:Button({
    Title = "植物VS大脑机器人",
    Desc = "已汉化",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/2EoYqTfl/raw"))()
    end
})

Tabs.FWTab:Button({
    Title = "99夜",
    Desc = "已汉化",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/2EoYqTfl/raw"))()
    end
})

Tabs.FWTab:Button({
    Title = "99夜",
    Desc = "虚空",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/99%E5%A4%9C%E8%99%9A%E7%A9%BA.txt"))()
    end
})

Tabs.FWTab:Button({
    Title = "99夜",
    Desc = "走马观花",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/Axg37JP7/raw"))()
    end
})

Tabs.FWTab:Button({
    Title = "99夜",
    Desc = "已汉化",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/Axg37JP7/raw"))()
    end
})

Tabs.KFTab:Button({
    Title = "自动翻译",
    Desc = "TK",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/JsYb666/Item/refs/heads/main/Auto-language"))()
    end
})

Tabs.HDTab:Button({
    Title = "伐木大亨",
    Desc = "作者思绪",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/oAqe0jak/raw"))()
    end
})

Tabs.CBTab:Button({
    Title = "种植花园",
    Desc = "没汉化",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/s9wO0IAp/raw"))()
    end
})

Tabs.CBTab:Button({
    Title = "种植花园",
    Desc = "好用",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MoziIOnTop/MoziIHub/refs/heads/main/GrowaGarden"))()
    end
})

Tabs.TYGNTab:Button({
    Title = "极速传奇",
    Desc = "不会用问我",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/DhttNHdb/raw"))()
    end
})

tabs.SFTab：按钮({
title="饲养宠物"，
DESC="过几天汉化"，
callback=函数()
loadstring(游戏：HttpGet("https://raw.githubusercontent.com/xwwwwwwwwwwwwwwwwwwwqd/loader/main/GamesData/RaiseAnimals.lua"))()
结束
})

tabs.HDTab：按钮({
title="伐木大亨"，
DESC="好用"，
callback=函数()
loadstring(游戏：HttpGet("https://pastefy.app/oRaDTAPK/raw"))()
结束
})

tabs.HZTab：按钮({
title="战争大亨"，
DESC="还行"，
callback=函数()
loadstring(游戏：HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/%E6%88%98%E4%BA%89%E5%A4%A7%E4%BA%A8.txt"))()
结束
})

tabs.HZTab：按钮({
title="战争大亨"，
DESC="XK中心"，
callback=函数()
loadstring(游戏：HttpGet(('https://github.com/devslopo/DVES/raw/main/XK%20Hub')))()
结束
})

tabs.ZRTab：按钮({
标题="无敌少侠"，
DESC="好用"，
回调=函数()
loadstring(游戏：HttpGet("https://rawscripts.net/raw/Universal-Script-Invinicible-Flight-R15-45414"))()
结束
})

tabs.DZTab：按钮({
标题="还可以"，
DESC="汉化"，
回调=函数()
loadstring(游戏：HttpGet("https://pastefy.app/Ie55j0hs/raw"))()
结束
})

tabs.PVPTab：按钮({
标题="兵工厂"，
DESC="德与中山"，
回调=函数()
loadstring(游戏：HttpGet("https://pastefy.app/4onOuqPM/raw"))()
结束
})

tabs.tyTab：按钮({
title="WX飞行"，
DESC="特别推荐用"，
回调=函数()
loadstring(游戏：HttpGet("https://pastefy.app/jvbKaDSn/raw"))()
结束
})

tabs.tyTab：按钮({
标题="无限跳跃"，
DESC=""，
回调=函数()
loadstring(游戏：HttpGet("https://pastebin.com/raw/V5PQy3y0"))()
结束
})

tabs.tyTab：按钮({
title="XK飞行"，
DESC=""，
回调=函数()
loadstring(game:HttpGet("https://raw.githubusercontent.com/BINjiaobzx6/BINjiao/main/%E9%A3%9E%E8%A1%8C%E8%84%9A%E6%9C%AC(%E5%8F%AF%E8%87%AA%E7%94%B1%E5%85%B3%E9%97%AD%E9%9A%90%E8%97%8F)%20%E6%B1%89%E5%8C%96%20(3)%20(1).txt"))()
结束
})

tabs.tyTab：按钮({
标题="冷飞行"，
DESC=""，
回调=函数()
loadstring(game:HttpGet("https://raw.githubusercontent.com/odhdshhe/-V3.0/refs/heads/main/%E9%A3%9E%E8%A1%8C%E8%84%9A%E6%9C%ACV3(%E5%85%A8%E6%B8%B8%E6%88%8F%E9%80%9A%E7%94%A8)%20(1).txt"))()
结束
})

tabs.tyTab：按钮({
标题="飞车"，
DESC=""，
回调=函数()
loadstring(游戏：HttpGet("https://raw.githubusercontent.com/smalldesikon/eyidfki/main/%E9%A3%9E%E8%BD%A6(%E6%BA%90%E7%A0%81).lua"))()
结束
})

tabs.tyTab：按钮({
标题="踏空行走"，
DESC=""，
回调=函数()
loadstring(游戏：HttpGet('https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Float'))()
结束
})

tabs.tyTab：按钮({
标题="爬墙"，
DESC="关不了别用"，
回调=函数()
loadstring(游戏：HttpGet("https://pastebin.com/raw/zXk4Rq2r"))()
结束
})

tabs.tyTab：按钮({
标题="反挂机1"，
DESC=""，
回调=函数()
标题="伐木大亨"，
DESC="好用"，
回调=函数()

结束
标题="反挂机2"，
DESC=""，
tabs.HZTab：按钮({
标题="战争大亨"，
DESC="还行"，
回调=函数()

结束
标题="透视1"，
DESC=""，
tabs.HZTab：按钮({
标题="战争大亨"，
DESC="XK中心"，
回调=函数()

结束
标题="透视2"，
DESC=""，
回调=函数()
loadstring(游戏：HttpGet('https://raw.githubusercontent.com/Lucasfin000/SpaceHub/main/UESP'))()
tabs.HZTab：按钮({
标题="战争大亨"，

回调=函数()
loadstring(游戏：HttpGet(('https://github.com/devslopo/DVES/raw/main/XK%20Hub')))()
结束
回调=函数()
loadstring(游戏：HttpGet("https://pastefy.app/zS4kJf46/raw"))()
tabs.ZRTab：按钮({
标题="无敌少侠"，

回调=函数()
loadstring(游戏：HttpGet("https://rawscripts.net/raw/Universal-Script-Invinicible-Flight-R15-45414"))()
结束
回调=函数()
loadstring(游戏：HttpGet("https://raw.githubusercontent.com/TtmScripter/OtherScript/main/Noclip"))()
tabs.DZTab：按钮({
标题="还可以"，
